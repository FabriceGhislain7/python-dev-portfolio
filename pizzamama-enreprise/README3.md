# PizzaMama Enterprise - Setup Guide

## üöÄ Guida Completa Setup Professionale

### Prerequisiti
- Python 3.9+ installato
- PowerShell o Command Prompt
- Git (opzionale ma consigliato)

---

## üçï Step 9: Models Products Enterprise

### 9.1 Crea modelli Products completi
**Apri `apps/products/models.py` e sostituisci tutto il contenuto con:**

#### **Modelli principali:**
```python
from django.db import models
from django.utils.text import slugify
from django.core.validators import MinValueValidator, MaxValueValidator
from django.urls import reverse

# Category - Categorie gerarchiche pizze
class Category(models.Model):
    name = models.CharField(max_length=100, unique=True)
    slug = models.SlugField(max_length=100, unique=True, blank=True)
    parent = models.ForeignKey('self', null=True, blank=True, on_delete=models.CASCADE)
    image = models.ImageField(upload_to='categories/', blank=True)
    is_active = models.BooleanField(default=True)
    # ... altri campi

# Allergen - Gestione allergeni compliance
class Allergen(models.Model):
    name = models.CharField(max_length=50, unique=True)
    symbol = models.CharField(max_length=10)
    color_code = models.CharField(max_length=7, default="#FF0000")
    # ... altri campi

# Ingredient - Ingredienti con stock e pricing
class Ingredient(models.Model):
    name = models.CharField(max_length=100, unique=True)
    cost_per_unit = models.DecimalField(max_digits=6, decimal_places=2)
    price_per_extra = models.DecimalField(max_digits=6, decimal_places=2, default=0.00)
    stock_quantity = models.PositiveIntegerField(default=0)
    allergens = models.ManyToManyField(Allergen, blank=True)
    is_vegetarian = models.BooleanField(default=True)
    is_vegan = models.BooleanField(default=False)
    # ... altri campi

# PizzaSize - Taglie con pricing differenziato
class PizzaSize(models.Model):
    name = models.CharField(max_length=20, unique=True)
    diameter_cm = models.PositiveIntegerField()
    price_multiplier = models.DecimalField(max_digits=3, decimal_places=2, default=1.0)
    # ... altri campi

# Pizza - Modello principale
class Pizza(models.Model):
    name = models.CharField(max_length=100, unique=True)
    slug = models.SlugField(max_length=100, unique=True, blank=True)
    category = models.ForeignKey(Category, on_delete=models.CASCADE)
    ingredients = models.ManyToManyField(Ingredient, through='PizzaIngredient')
    base_price = models.DecimalField(max_digits=8, decimal_places=2)
    image = models.ImageField(upload_to='pizzas/')
    is_featured = models.BooleanField(default=False)
    avg_rating = models.DecimalField(max_digits=3, decimal_places=2, default=0.00)
    # ... altri campi per SEO, analytics, nutritional info

# PizzaIngredient - Tabella intermedia con quantit√†
class PizzaIngredient(models.Model):
    pizza = models.ForeignKey(Pizza, on_delete=models.CASCADE)
    ingredient = models.ForeignKey(Ingredient, on_delete=models.CASCADE)
    quantity = models.DecimalField(max_digits=6, decimal_places=2)
    is_removable = models.BooleanField(default=True)
    # ... altri campi
```

### 9.2 Configura admin interface
**Modifica `apps/products/admin.py`:**

```python
from django.contrib import admin
from django.utils.html import format_html
from .models import Category, Allergen, Ingredient, Pizza, PizzaSize, PizzaIngredient

@admin.register(Category)
class CategoryAdmin(admin.ModelAdmin):
    list_display = ['name', 'parent', 'is_active', 'sort_order']
    prepopulated_fields = {'slug': ('name',)}

@admin.register(Allergen)
class AllergenAdmin(admin.ModelAdmin):
    list_display = ['name', 'symbol', 'colored_badge']

@admin.register(Ingredient)
class IngredientAdmin(admin.ModelAdmin):
    list_display = ['name', 'price_per_extra', 'stock_status', 'is_vegetarian']
    filter_horizontal = ['allergens']

@admin.register(Pizza)
class PizzaAdmin(admin.ModelAdmin):
    list_display = ['name', 'category', 'base_price', 'avg_rating', 'is_featured']
    prepopulated_fields = {'slug': ('name',)}
    inlines = [PizzaIngredientInline]
```

### 9.3 Crea e applica migrazioni
```powershell
py manage.py makemigrations products
py manage.py migrate
```

### 9.4 Test admin interface
```powershell
py manage.py runserver
```

**üîó Verifica in admin (`/admin/`):**
- **PRODUCTS** section con: Allergeni, Categorie, Ingredienti, Pizze, Taglie Pizza
- **Interface avanzate** con filtri, search, inline editing
- **Badge colorati** per allergeni e stock status

**üìä Features modelli:**
- **Categorie gerarchiche** ‚Üí Sottocategorie infinite
- **Gestione allergeni** ‚Üí Compliance alimentare completa
- **Stock management** ‚Üí Quantit√† e alert scorte basse
- **Pricing dinamico** ‚Üí Moltiplicatori per taglie diverse
- **SEO ready** ‚Üí Slug, meta tags, URL friendly
- **Analytics fields** ‚Üí Rating, popularity, reviews count
- **Media management** ‚Üí Immagini con gallery JSON

---

## üìä Step 8: Database Modeling Enterprise

### 8.1 Installa Pillow per gestione immagini
```powershell
py -m pip install Pillow==10.2.0
```

**üìã Cosa installa:**
- `Pillow==10.2.0` ‚Üí Libreria gestione immagini (JPEG, PNG, GIF)
- Necessario per `ImageField` in Django
- Funzionalit√†: resize, thumbnail, validazione formato

### 8.2 Crea CustomUser model (apps/accounts/models.py)
**Apri `apps/accounts/models.py` e sostituisci tutto il contenuto:**

```python
from django.contrib.auth.models import AbstractUser
from django.db import models
from django.core.validators import RegexValidator

class CustomUser(AbstractUser):
    """
    Custom User model esteso per PizzaMama
    """
    # Contact info
    phone_regex = RegexValidator(
        regex=r'^\+?1?\d{9,15}

## üìÅ Step 1: Creazione Ambiente e Struttura

### 1.1 Crea la directory del progetto
```powershell
mkdir pizzamama-enreprise
cd pizzamama-enreprise
```

### 1.2 Crea ambiente virtuale
```powershell
py -m venv venv
```

### 1.3 Attiva ambiente virtuale
```powershell
# Windows PowerShell
.\venv\Scripts\activate

# Windows CMD
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

**‚úÖ Verifica:** Dovresti vedere `(venv)` all'inizio del prompt

---

## üì¶ Step 2: Installazione Django

### 2.1 Aggiorna pip (opzionale ma consigliato)
```powershell
py -m pip install --upgrade pip
```

### 2.2 Installa Django
```powershell
py -m pip install Django==5.0.1
```

**üìã Cosa installa:**
- `Django==5.0.1` ‚Üí Framework web principale
- `asgiref` ‚Üí Supporto ASGI per apps asincrone
- `sqlparse` ‚Üí Parser SQL per Django ORM
- `tzdata` ‚Üí Database timezone
- `typing_extensions` ‚Üí Type hints avanzati

---

## üèóÔ∏è Step 3: Creazione Progetto Django

### 3.1 Crea directory src/ (approccio enterprise)
```powershell
mkdir src
cd src
```

### 3.2 Crea progetto Django
```powershell
django-admin startproject pizzamama .
```

**üìÅ Struttura creata:**
```
src/
‚îú‚îÄ‚îÄ manage.py          ‚Üê File principale Django
‚îî‚îÄ‚îÄ pizzamama/         ‚Üê Configurazioni progetto
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ settings.py    ‚Üê Configurazioni Django
    ‚îú‚îÄ‚îÄ urls.py        ‚Üê URL routing principale
    ‚îú‚îÄ‚îÄ wsgi.py        ‚Üê Server produzione
    ‚îî‚îÄ‚îÄ asgi.py        ‚Üê Server asincrono
```

**üéØ Spiegazione comando:**
- `django-admin` ‚Üí Tool CLI di Django
- `startproject` ‚Üí Crea nuovo progetto
- `pizzamama` ‚Üí Nome del progetto
- `.` ‚Üí Crea nella directory corrente (importante!)

---

## ‚úÖ Step 4: Test Installazione

### 4.1 Avvia server di sviluppo
```powershell
py manage.py runserver
```

**üìä Output atteso:**
```
Watching for file changes with StatReloader
Performing system checks...
System check identified no issues (0 silenced).
You have 18 unapplied migration(s)...
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```

### 4.2 Verifica nel browser
- Apri: `http://127.0.0.1:8000/`
- Dovresti vedere: "The install worked successfully! Congratulations!"

### 4.3 Ferma il server
```powershell
# Premi Ctrl+C (o Ctrl+Break su Windows)
```

---

## üóÑÔ∏è Step 5: Setup Database

### 5.1 Applica migrazioni iniziali
```powershell
py manage.py migrate
```

**üìã Cosa succede:**
- Crea database SQLite (`db.sqlite3`)
- Crea tabelle: User, Session, Admin, ContentType, Permission
- Setup necessario per sistema autenticazione Django

### 5.2 Crea superuser per admin
```powershell
py manage.py createsuperuser
```

**üìù Ti chieder√†:**
- **Username:** (es. `admin`)
- **Email:** (opzionale, premi Enter)
- **Password:** (non si vede mentre scrivi)

### 5.3 Test admin panel
```powershell
py manage.py runserver
```
- Vai su: `http://127.0.0.1:8000/admin/`
- Login con le credenziali create

---

## üåê Step 6: Django REST Framework Setup

### 6.1 Installa Django REST Framework
```powershell
py -m pip install djangorestframework==3.14.0
```

**üìã Cosa installa:**
- `djangorestframework==3.14.0` ‚Üí Framework API REST
- `pytz` ‚Üí Gestione timezone (dipendenza DRF)

### 6.2 Configura DRF in settings.py
**Apri `src/pizzamama/settings.py` e modifica:**

**Aggiungi a `INSTALLED_APPS`:**
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party apps
    'rest_framework',          # ‚Üê AGGIUNGI QUESTA RIGA
]
```

**Aggiungi alla fine del file:**
```python
# Django REST Framework
REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
        'rest_framework.authentication.BasicAuthentication',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20
}
```

### 6.3 Configura URL API
**Modifica `src/pizzamama/urls.py`:**
```python
from django.contrib import admin
from django.urls import path, include
from rest_framework.decorators import api_view
from rest_framework.response import Response

@api_view(['GET'])
def api_root(request):
    return Response({
        'message': 'Benvenuto alle API di PizzaMama!',
        'version': '1.0',
        'endpoints': {
            'admin': '/admin/',
            'api-auth': '/api/auth/login/',
        }
    })

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', api_root, name='api-root'),           # ‚Üê Homepage API
    path('api/auth/', include('rest_framework.urls')), # ‚Üê Login/logout DRF
]
```

### 6.4 Test API
```powershell
py manage.py runserver
```

**üîó URL da testare:**
- `http://127.0.0.1:8000/api/` ‚Üí Vista benvenuto API (JSON)
- `http://127.0.0.1:8000/api/auth/login/` ‚Üí Login DRF
- `http://127.0.0.1:8000/admin/` ‚Üí Admin Django

**üéØ Risultato atteso:** Interfaccia API browsable di DRF con messaggio di benvenuto

---

## üèóÔ∏è Step 7: Creazione Apps Enterprise

### 7.1 Crea cartella apps/ (devi essere in src/)
```powershell
mkdir apps
cd apps
```

### 7.2 Crea file __init__.py per package Python
```powershell
# Windows PowerShell
New-Item -Path "__init__.py" -ItemType File -Force
```

### 7.3 Crea le app Django una alla volta
```powershell
# Crea app accounts (gestione utenti)
py ../manage.py startapp accounts

# Crea app products (catalogo pizze)
py ../manage.py startapp products

# Crea app orders (gestione ordini)
py ../manage.py startapp orders
```

### 7.4 Verifica struttura creata
```powershell
ls
```

**üìÅ Dovresti vedere:**
```
apps/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ accounts/
‚îú‚îÄ‚îÄ products/
‚îî‚îÄ‚îÄ orders/
```

### 7.5 Configura apps nei Django settings
**Torna in src/ e modifica settings.py:**
```powershell
cd ..
code pizzamama/settings.py
```

**Aggiorna `INSTALLED_APPS`:**
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party apps
    'rest_framework',
    
    # Local apps
    'apps.accounts',    # ‚Üê AGGIUNGI
    'apps.products',    # ‚Üê AGGIUNGI
    'apps.orders',      # ‚Üê AGGIUNGI
]
```

### 7.6 Fix configurazione app (IMPORTANTE!)
**Per ogni app creata, modifica il file `apps.py`:**

**`apps/accounts/apps.py`:**
```python
from django.apps import AppConfig

class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.accounts'  # ‚Üê Cambia da 'accounts' a 'apps.accounts'
```

**`apps/products/apps.py`:**
```python
from django.apps import AppConfig

class ProductsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.products'  # ‚Üê Cambia da 'products' a 'apps.products'
```

**`apps/orders/apps.py`:**
```python
from django.apps import AppConfig

class OrdersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.orders'  # ‚Üê Cambia da 'orders' a 'apps.orders'
```

### 7.7 Test configurazione
```powershell
py manage.py check
```

**‚úÖ Output atteso:** `System check identified no issues (0 silenced).`

### 7.8 Crea migrazioni iniziali (opzionale)
```powershell
py manage.py makemigrations accounts
py manage.py makemigrations products
py manage.py makemigrations orders
```

**üìã Output atteso:** `No changes detected` (normale, non ci sono ancora modelli custom)

---

## üìÇ Struttura Attuale del Progetto

```
pizzamama-enreprise/
‚îú‚îÄ‚îÄ venv/                    ‚Üê Ambiente virtuale
‚îú‚îÄ‚îÄ src/                     ‚Üê Codice sorgente (approccio enterprise)
‚îÇ   ‚îú‚îÄ‚îÄ manage.py           ‚Üê Comando principale Django
‚îÇ   ‚îú‚îÄ‚îÄ db.sqlite3          ‚Üê Database SQLite con tutti i modelli
‚îÇ   ‚îú‚îÄ‚îÄ apps/               ‚Üê Apps business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accounts/       ‚Üê Gestione utenti COMPLETA
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py   ‚Üê CustomUser + Profile + Address
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ apps.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/       ‚Üê Catalogo enterprise COMPLETO
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py   ‚Üê Pizza + Category + Ingredient + Allergen
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py    ‚Üê Interface avanzate con filtri
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ apps.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ orders/         ‚Üê Gestione ordini (da completare)
‚îÇ   ‚îî‚îÄ‚îÄ pizzamama/          ‚Üê Configurazioni progetto Django
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ settings.py     ‚Üê Con CustomUser e DRF configurati
‚îÇ       ‚îú‚îÄ‚îÄ urls.py         ‚Üê URL routing con API
‚îÇ       ‚îú‚îÄ‚îÄ wsgi.py
‚îÇ       ‚îî‚îÄ‚îÄ asgi.py
‚îî‚îÄ‚îÄ structure.py            ‚Üê File di esempio (da rimuovere)
```

---

## üéØ Stato Attuale

### ‚úÖ Completato
- [x] Ambiente virtuale Python
- [x] Django 5.0.1 installato
- [x] Progetto Django creato
- [x] Database setup (SQLite)
- [x] Admin panel funzionante
- [x] Server di sviluppo testato
- [x] Django REST Framework installato
- [x] API endpoint di benvenuto configurato
- [x] Apps enterprise create (accounts, products, orders)
- [x] Struttura moduli configurata
- [x] Pillow installato per gestione immagini
- [x] CustomUser model creato con profili e indirizzi
- [x] Models Products completi (Pizza, Category, Ingredient, etc.)

### üîÑ Prossimi Step (da completare)
- [x] Django REST Framework (API)
- [x] Struttura apps (accounts, products, orders, etc.)
- [x] Models accounts con CustomUser
- [x] Models products (Pizza, Category, Ingredient)
- [ ] Models orders (Order, OrderItem, Cart)
- [ ] Admin interface configuration avanzata
- [ ] API serializers e viewsets
- [ ] PostgreSQL setup (database produzione)
- [ ] Frontend templates
- [ ] Sistema autenticazione custom
- [ ] File statici e media
- [ ] Docker setup
- [ ] Testing framework
- [ ] CI/CD pipeline

---

## üõ†Ô∏è Comandi Utili

### Development
```powershell
# Attiva ambiente
.\venv\Scripts\activate

# Avvia server
py manage.py runserver

# Nuove migrazioni
py manage.py makemigrations

# Applica migrazioni
py manage.py migrate

# Shell Django
py manage.py shell

# Crea nuova app
py manage.py startapp nome_app
```

### Troubleshooting
```powershell
# Verifica installazioni
py -m pip list

# Reinstalla Django
py -m pip uninstall Django
py -m pip install Django==5.0.1

# Reset database (ATTENZIONE: cancella tutti i dati)
rm db.sqlite3
py manage.py migrate
py manage.py createsuperuser
```

---

## üìö File Importanti Spiegati

### `manage.py`
File principale per tutti i comandi Django:
- `runserver` ‚Üí Avvia server sviluppo
- `migrate` ‚Üí Applica migrazioni database
- `createsuperuser` ‚Üí Crea admin user
- `startapp` ‚Üí Crea nuova app Django

### `settings.py`
Tutte le configurazioni Django:
- Database connection
- Apps installate
- Middleware
- Static files
- Security settings

### `urls.py`
Routing URL principale:
- Mappa URL a views
- Include URL di altre apps
- Admin panel routing

---

## üîß Environment Setup

### Windows PowerShell
```powershell
# Se hai problemi con pip, usa sempre:
py -m pip install package_name

# Per evitare problemi PowerShell execution policy:
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Variabili Ambiente (per dopo)
```powershell
# Creeremo file .env per:
# - Database credentials
# - Secret keys
# - API keys
# - Debug settings
```

---

## üéâ Congratulazioni!

Finora, abbiamo completato il setup enterprise di **PizzaMama**! 

### üèóÔ∏è **Architettura Enterprise Creata:**
- ‚úÖ **Ambiente isolato** con virtual environment
- ‚úÖ **Django 5.0.1** con best practices
- ‚úÖ **API REST** con Django REST Framework
- ‚úÖ **Struttura modulare** con apps separate
- ‚úÖ **Database** SQLite per development
- ‚úÖ **Admin panel** funzionante con superuser

### üì¶ **Apps Business Logic:**
- ‚úÖ **`apps.accounts`** ‚Üí **CustomUser** esteso con phone, preferences, marketing consent
- ‚úÖ **`Address`** ‚Üí Indirizzi multipli per delivery con coordinate GPS
- ‚úÖ **`Profile`** ‚Üí Loyalty points, avatar, preferenze alimentari (JSON)
- ‚úÖ **`apps.products`** ‚Üí **Catalogo enterprise completo:**
  - **`Category`** ‚Üí Categorie gerarchiche con SEO
  - **`Allergen`** ‚Üí Gestione allergeni con simboli colorati
  - **`Ingredient`** ‚Üí Stock management, pricing, allergie
  - **`Pizza`** ‚Üí Modello principale con analytics e media
  - **`PizzaSize`** ‚Üí Taglie con moltiplicatori prezzo
  - **`PizzaIngredient`** ‚Üí Relazione M2M con quantit√†
- üîÑ **`apps.orders`** ‚Üí Carrello e gestione ordini (prossimo step)

### üîó **API Endpoints Attivi:**
- **`/admin/`** ‚Üí Panel amministrazione Django
- **`/api/`** ‚Üí Homepage API con informazioni
- **`/api/auth/login/`** ‚Üí Interfaccia login DRF
- **`/api/auth/logout/`** ‚Üí Interfaccia logout DRF

Il progetto √® ora pronto per:
1. **üìä Models orders** ‚Üí Order, OrderItem, Cart con state machine e workflow
2. **üé® Admin interface avanzata** ‚Üí Dashboard completo per gestione e-commerce
3. **üîó API serializers** ‚Üí DRF ViewSets per CRUD completo su tutti i modelli
4. **üé® Frontend templates** ‚Üí Catalogo pizze, carrello, checkout
5. **üîê Authentication API** ‚Üí Registration, login, profile management
6. **üí≥ Payment integration** ‚Üí Stripe checkout e webhook
7. **ü§ñ ML features** ‚Üí Recommendation engine, demand forecasting
8. **üìä Analytics dashboard** ‚Üí Business intelligence e KPI monitoring
9. **üöÄ Production deployment** ‚Üí Docker, PostgreSQL, Redis

**Prossimo step:** Creazione modelli Orders (Order, OrderItem, Cart) con state machine per workflow ordini completo!, 
        message="Phone number must be entered in the format: '+999999999'. Up to 15 digits allowed."
    )
    phone = models.CharField(validators=[phone_regex], max_length=17, blank=True)
    
    # Personal info
    date_of_birth = models.DateField(null=True, blank=True)
    
    # Preferences
    preferred_language = models.CharField(
        max_length=5, 
        choices=[('it', 'Italiano'), ('en', 'English')], 
        default='it'
    )
    
    # Privacy & Marketing
    marketing_consent = models.BooleanField(default=False)
    is_verified = models.BooleanField(default=False)
    
    # Timestamps
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'accounts_user'
        verbose_name = 'Utente'
        verbose_name_plural = 'Utenti'
    
    def __str__(self):
        return f"{self.username} - {self.get_full_name()}"

class Address(models.Model):
    """
    Indirizzi di consegna multipli per utente
    """
    user = models.ForeignKey(CustomUser, on_delete=models.CASCADE, related_name='addresses')
    label = models.CharField(max_length=50, help_text="es. Casa, Ufficio, Altro")
    street_address = models.CharField(max_length=200)
    city = models.CharField(max_length=100)
    postal_code = models.CharField(max_length=10)
    province = models.CharField(max_length=50)
    country = models.CharField(max_length=50, default='Italia')
    
    # Coordinate per delivery (opzionale)
    latitude = models.DecimalField(max_digits=9, decimal_places=6, null=True, blank=True)
    longitude = models.DecimalField(max_digits=9, decimal_places=6, null=True, blank=True)
    
    is_default = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    
    class Meta:
        db_table = 'accounts_address'
        verbose_name = 'Indirizzo'
        verbose_name_plural = 'Indirizzi'
        unique_together = [['user', 'label']]
    
    def __str__(self):
        return f"{self.user.username} - {self.label}"

class Profile(models.Model):
    """
    Profilo utente esteso con preferenze e loyalty
    """
    user = models.OneToOneField(CustomUser, on_delete=models.CASCADE, related_name='profile')
    avatar = models.ImageField(upload_to='avatars/', blank=True)
    bio = models.TextField(max_length=500, blank=True)
    
    # Loyalty system
    loyalty_points = models.PositiveIntegerField(default=0)
    total_orders = models.PositiveIntegerField(default=0)
    total_spent = models.DecimalField(max_digits=10, decimal_places=2, default=0.00)
    
    # Preferences JSON field per dietary restrictions, favorite pizzas, etc.
    preferences = models.JSONField(default=dict, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    
    class Meta:
        db_table = 'accounts_profile'
        verbose_name = 'Profilo'
        verbose_name_plural = 'Profili'
    
    def __str__(self):
        return f"Profilo di {self.user.username}"
```

### 8.3 Configura CustomUser in settings.py
**Aggiungi alla fine di `pizzamama/settings.py`:**

```python
# Custom User Model
AUTH_USER_MODEL = 'accounts.CustomUser'
```

### 8.4 Reset database per CustomUser (NECESSARIO!)
```powershell
# 1. Cancella database esistente
del db.sqlite3

# 2. Crea migrazioni
py manage.py makemigrations accounts

# 3. Crea migrazioni per altre app (se necessario)
py manage.py makemigrations products
py manage.py makemigrations orders

# 4. Applica tutte le migrazioni
py manage.py migrate

# 5. Crea nuovo superuser
py manage.py createsuperuser
```

### 8.5 Test setup CustomUser
```powershell
py manage.py runserver
```

**üîó Verifica:**
- `http://127.0.0.1:8000/admin/` ‚Üí Login con nuovo superuser
- Nella sezione "ACCOUNTS" dovresti vedere: Utenti, Indirizzi, Profili

---

## üìÅ Step 1: Creazione Ambiente e Struttura

### 1.1 Crea la directory del progetto
```powershell
mkdir pizzamama-enreprise
cd pizzamama-enreprise
```

### 1.2 Crea ambiente virtuale
```powershell
py -m venv venv
```

### 1.3 Attiva ambiente virtuale
```powershell
# Windows PowerShell
.\venv\Scripts\activate

# Windows CMD
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

**‚úÖ Verifica:** Dovresti vedere `(venv)` all'inizio del prompt

---

## üì¶ Step 2: Installazione Django

### 2.1 Aggiorna pip (opzionale ma consigliato)
```powershell
py -m pip install --upgrade pip
```

### 2.2 Installa Django
```powershell
py -m pip install Django==5.0.1
```

**üìã Cosa installa:**
- `Django==5.0.1` ‚Üí Framework web principale
- `asgiref` ‚Üí Supporto ASGI per apps asincrone
- `sqlparse` ‚Üí Parser SQL per Django ORM
- `tzdata` ‚Üí Database timezone
- `typing_extensions` ‚Üí Type hints avanzati

---

## üèóÔ∏è Step 3: Creazione Progetto Django

### 3.1 Crea directory src/ (approccio enterprise)
```powershell
mkdir src
cd src
```

### 3.2 Crea progetto Django
```powershell
django-admin startproject pizzamama .
```

**üìÅ Struttura creata:**
```
src/
‚îú‚îÄ‚îÄ manage.py          ‚Üê File principale Django
‚îî‚îÄ‚îÄ pizzamama/         ‚Üê Configurazioni progetto
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ settings.py    ‚Üê Configurazioni Django
    ‚îú‚îÄ‚îÄ urls.py        ‚Üê URL routing principale
    ‚îú‚îÄ‚îÄ wsgi.py        ‚Üê Server produzione
    ‚îî‚îÄ‚îÄ asgi.py        ‚Üê Server asincrono
```

**üéØ Spiegazione comando:**
- `django-admin` ‚Üí Tool CLI di Django
- `startproject` ‚Üí Crea nuovo progetto
- `pizzamama` ‚Üí Nome del progetto
- `.` ‚Üí Crea nella directory corrente (importante!)

---

## ‚úÖ Step 4: Test Installazione

### 4.1 Avvia server di sviluppo
```powershell
py manage.py runserver
```

**üìä Output atteso:**
```
Watching for file changes with StatReloader
Performing system checks...
System check identified no issues (0 silenced).
You have 18 unapplied migration(s)...
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```

### 4.2 Verifica nel browser
- Apri: `http://127.0.0.1:8000/`
- Dovresti vedere: "The install worked successfully! Congratulations!"

### 4.3 Ferma il server
```powershell
# Premi Ctrl+C (o Ctrl+Break su Windows)
```

---

## üóÑÔ∏è Step 5: Setup Database

### 5.1 Applica migrazioni iniziali
```powershell
py manage.py migrate
```

**üìã Cosa succede:**
- Crea database SQLite (`db.sqlite3`)
- Crea tabelle: User, Session, Admin, ContentType, Permission
- Setup necessario per sistema autenticazione Django

### 5.2 Crea superuser per admin
```powershell
py manage.py createsuperuser
```

**üìù Ti chieder√†:**
- **Username:** (es. `admin`)
- **Email:** (opzionale, premi Enter)
- **Password:** (non si vede mentre scrivi)

### 5.3 Test admin panel
```powershell
py manage.py runserver
```
- Vai su: `http://127.0.0.1:8000/admin/`
- Login con le credenziali create

---

## üåê Step 6: Django REST Framework Setup

### 6.1 Installa Django REST Framework
```powershell
py -m pip install djangorestframework==3.14.0
```

**üìã Cosa installa:**
- `djangorestframework==3.14.0` ‚Üí Framework API REST
- `pytz` ‚Üí Gestione timezone (dipendenza DRF)

### 6.2 Configura DRF in settings.py
**Apri `src/pizzamama/settings.py` e modifica:**

**Aggiungi a `INSTALLED_APPS`:**
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party apps
    'rest_framework',          # ‚Üê AGGIUNGI QUESTA RIGA
]
```

**Aggiungi alla fine del file:**
```python
# Django REST Framework
REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
        'rest_framework.authentication.BasicAuthentication',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20
}
```

### 6.3 Configura URL API
**Modifica `src/pizzamama/urls.py`:**
```python
from django.contrib import admin
from django.urls import path, include
from rest_framework.decorators import api_view
from rest_framework.response import Response

@api_view(['GET'])
def api_root(request):
    return Response({
        'message': 'Benvenuto alle API di PizzaMama!',
        'version': '1.0',
        'endpoints': {
            'admin': '/admin/',
            'api-auth': '/api/auth/login/',
        }
    })

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', api_root, name='api-root'),           # ‚Üê Homepage API
    path('api/auth/', include('rest_framework.urls')), # ‚Üê Login/logout DRF
]
```

### 6.4 Test API
```powershell
py manage.py runserver
```

**üîó URL da testare:**
- `http://127.0.0.1:8000/api/` ‚Üí Vista benvenuto API (JSON)
- `http://127.0.0.1:8000/api/auth/login/` ‚Üí Login DRF
- `http://127.0.0.1:8000/admin/` ‚Üí Admin Django

**üéØ Risultato atteso:** Interfaccia API browsable di DRF con messaggio di benvenuto

---

## üèóÔ∏è Step 7: Creazione Apps Enterprise

### 7.1 Crea cartella apps/ (devi essere in src/)
```powershell
mkdir apps
cd apps
```

### 7.2 Crea file __init__.py per package Python
```powershell
# Windows PowerShell
New-Item -Path "__init__.py" -ItemType File -Force
```

### 7.3 Crea le app Django una alla volta
```powershell
# Crea app accounts (gestione utenti)
py ../manage.py startapp accounts

# Crea app products (catalogo pizze)
py ../manage.py startapp products

# Crea app orders (gestione ordini)
py ../manage.py startapp orders
```

### 7.4 Verifica struttura creata
```powershell
ls
```

**üìÅ Dovresti vedere:**
```
apps/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ accounts/
‚îú‚îÄ‚îÄ products/
‚îî‚îÄ‚îÄ orders/
```

### 7.5 Configura apps nei Django settings
**Torna in src/ e modifica settings.py:**
```powershell
cd ..
code pizzamama/settings.py
```

**Aggiorna `INSTALLED_APPS`:**
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party apps
    'rest_framework',
    
    # Local apps
    'apps.accounts',    # ‚Üê AGGIUNGI
    'apps.products',    # ‚Üê AGGIUNGI
    'apps.orders',      # ‚Üê AGGIUNGI
]
```

### 7.6 Fix configurazione app (IMPORTANTE!)
**Per ogni app creata, modifica il file `apps.py`:**

**`apps/accounts/apps.py`:**
```python
from django.apps import AppConfig

class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.accounts'  # ‚Üê Cambia da 'accounts' a 'apps.accounts'
```

**`apps/products/apps.py`:**
```python
from django.apps import AppConfig

class ProductsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.products'  # ‚Üê Cambia da 'products' a 'apps.products'
```

**`apps/orders/apps.py`:**
```python
from django.apps import AppConfig

class OrdersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.orders'  # ‚Üê Cambia da 'orders' a 'apps.orders'
```

### 7.7 Test configurazione
```powershell
py manage.py check
```

**‚úÖ Output atteso:** `System check identified no issues (0 silenced).`

### 7.8 Crea migrazioni iniziali (opzionale)
```powershell
py manage.py makemigrations accounts
py manage.py makemigrations products
py manage.py makemigrations orders
```

**üìã Output atteso:** `No changes detected` (normale, non ci sono ancora modelli custom)

---

## üìÇ Struttura Attuale del Progetto

```
pizzamama-enreprise/
‚îú‚îÄ‚îÄ venv/                    ‚Üê Ambiente virtuale
‚îú‚îÄ‚îÄ src/                     ‚Üê Codice sorgente (approccio enterprise)
‚îÇ   ‚îú‚îÄ‚îÄ manage.py           ‚Üê Comando principale Django
‚îÇ   ‚îú‚îÄ‚îÄ db.sqlite3          ‚Üê Database SQLite (creato dopo migrate)
‚îÇ   ‚îú‚îÄ‚îÄ apps/               ‚Üê Apps business logic (NUOVO!)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accounts/       ‚Üê Gestione utenti
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/       ‚Üê Catalogo pizze
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ orders/         ‚Üê Gestione ordini
‚îÇ   ‚îî‚îÄ‚îÄ pizzamama/          ‚Üê Configurazioni progetto Django
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ settings.py     ‚Üê Tutte le configurazioni
‚îÇ       ‚îú‚îÄ‚îÄ urls.py         ‚Üê URL routing con API
‚îÇ       ‚îú‚îÄ‚îÄ wsgi.py         ‚Üê Server produzione
‚îÇ       ‚îî‚îÄ‚îÄ asgi.py         ‚Üê Server asincrono
‚îî‚îÄ‚îÄ structure.py            ‚Üê File di esempio (da rimuovere)
```

---

## üéØ Stato Attuale

### ‚úÖ Completato
- [x] Ambiente virtuale Python
- [x] Django 5.0.1 installato
- [x] Progetto Django creato
- [x] Database setup (SQLite)
- [x] Admin panel funzionante
- [x] Server di sviluppo testato
- [x] Django REST Framework installato
- [x] API endpoint di benvenuto configurato
- [x] Apps enterprise create (accounts, products, orders)
- [x] Struttura moduli configurata

### üîÑ Prossimi Step (da completare)
- [x] Django REST Framework (API)
- [x] Struttura apps (accounts, products, orders, etc.)
- [ ] Models e database design
- [ ] PostgreSQL setup (database produzione)
- [ ] Frontend templates
- [ ] Sistema autenticazione custom
- [ ] File statici e media
- [ ] Docker setup
- [ ] Testing framework
- [ ] CI/CD pipeline

---

## üõ†Ô∏è Comandi Utili

### Development
```powershell
# Attiva ambiente
.\venv\Scripts\activate

# Avvia server
py manage.py runserver

# Nuove migrazioni
py manage.py makemigrations

# Applica migrazioni
py manage.py migrate

# Shell Django
py manage.py shell

# Crea nuova app
py manage.py startapp nome_app
```

### Troubleshooting
```powershell
# Verifica installazioni
py -m pip list

# Reinstalla Django
py -m pip uninstall Django
py -m pip install Django==5.0.1

# Reset database (ATTENZIONE: cancella tutti i dati)
rm db.sqlite3
py manage.py migrate
py manage.py createsuperuser
```

---

## üìö File Importanti Spiegati

### `manage.py`
File principale per tutti i comandi Django:
- `runserver` ‚Üí Avvia server sviluppo
- `migrate` ‚Üí Applica migrazioni database
- `createsuperuser` ‚Üí Crea admin user
- `startapp` ‚Üí Crea nuova app Django

### `settings.py`
Tutte le configurazioni Django:
- Database connection
- Apps installate
- Middleware
- Static files
- Security settings

### `urls.py`
Routing URL principale:
- Mappa URL a views
- Include URL di altre apps
- Admin panel routing

---

## üîß Environment Setup

### Windows PowerShell
```powershell
# Se hai problemi con pip, usa sempre:
py -m pip install package_name

# Per evitare problemi PowerShell execution policy:
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Variabili Ambiente (per dopo)
```powershell
# Creeremo file .env per:
# - Database credentials
# - Secret keys
# - API keys
# - Debug settings
```

---

## üéâ Congratulazioni!

Finora, abbiamo completato il setup enterprise di **PizzaMama**! 

### üèóÔ∏è **Architettura Enterprise Creata:**
- ‚úÖ **Ambiente isolato** con virtual environment
- ‚úÖ **Django 5.0.1** con best practices
- ‚úÖ **API REST** con Django REST Framework
- ‚úÖ **Struttura modulare** con apps separate
- ‚úÖ **Database** SQLite per development
- ‚úÖ **Admin panel** funzionante con superuser

### üì¶ **Apps Business Logic:**
- ‚úÖ **`apps.accounts`** ‚Üí Gestione utenti e autenticazione
- ‚úÖ **`apps.products`** ‚Üí Catalogo pizze e ingredienti
- ‚úÖ **`apps.orders`** ‚Üí Carrello e gestione ordini

### üîó **API Endpoints Attivi:**
- **`/admin/`** ‚Üí Panel amministrazione Django
- **`/api/`** ‚Üí Homepage API con informazioni
- **`/api/auth/login/`** ‚Üí Interfaccia login DRF
- **`/api/auth/logout/`** ‚Üí Interfaccia logout DRF

Il progetto √® ora pronto per:
1. **üìä Database modeling** ‚Üí Creare modelli User, Pizza, Order
2. **üé® Frontend development** ‚Üí Templates e interfacce
3. **üîê Authentication system** ‚Üí Login, registrazione, profili
4. **üí≥ Payment integration** ‚Üí Stripe, PayPal
5. **ü§ñ ML features** ‚Üí Raccomandazioni, analytics
6. **üöÄ Production deployment** ‚Üí Docker, PostgreSQL

**Prossimo step:** Creazione modelli database enterprise per gestire utenti, prodotti e ordini!