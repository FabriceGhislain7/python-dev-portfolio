{% extends "layout.html" %}
{% block title %}Menu iniziale{% endblock %}

{% block content %}

<!-- HERO con animazione -->
<section class="py-5 text-center bg-secondary text-white rounded-5 mb-4 shadow-lg hero-section">
  <div class="container">
    <h1 class="display-5 fw-bold mb-3 fade-in text-white">Menu Principale</h1>
    <p class="lead fade-in-delay text-white">Benvenuto nel gioco GDR! Scegli una sezione per proseguire.</p>
    <div class="hero-decoration">
      <i class="bi bi-dice-6 fs-1 opacity-25 position-absolute top-0 start-0 m-4"></i>
      <i class="bi bi-shield-shaded fs-1 opacity-25 position-absolute top-0 end-0 m-4"></i>
    </div>
  </div>
</section>

<!-- Pulsanti di scelta con animazioni -->
<div class="container mb-4">
  <div class="row g-3">
    <div class="col-12 col-md-6 d-flex justify-content-center">
      <button id="btn-area" class="btn btn-outline-primary btn-lg fw-bold main-button" onclick="showSection('area-personale')" style="width: 80%;">
        <i class="bi bi-person-circle me-2"></i>Area Personale
        <div class="button-shine"></div>
      </button>
    </div>

    <div class="col-12 col-md-6 d-flex justify-content-center">
      <button id="btn-gioco" class="btn btn-outline-success btn-lg fw-bold main-button" onclick="showSection('modalita-gioco')" style="width: 80%;">
        <i class="bi bi-controller me-2"></i>Modalità di Gioco
        <div class="button-shine"></div>
      </button>
    </div>
  </div>
</div>

<!-- Sezione: Area Personale -->
<div class="container mt-4 section-block" id="area-personale" style="display: none;">
  <h2 class="text-center mb-4 text-primary section-title">
    <i class="bi bi-person-badge me-2"></i>Area Personale
  </h2>
  <div class="row g-3">
    <div class="col-12 col-md-6">
      <div class="card h-100 text-center shadow-sm game-card" id="card-profilo">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-person-gear fs-4"></i>
        </div>
        <div class="card-body">
          <h5 class="card-title">Profilo</h5>
          <p class="card-text text-muted small">Gestisci il tuo account e i tuoi crediti</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('auth.modified_user') }}" class="btn btn-warning">
              <i class="bi bi-pencil-square me-2"></i>Modifica utente
            </a>
            <a href="{{ url_for('auth.credit_refill') }}" class="btn btn-info text-white">
              <i class="bi bi-bank me-2"></i>Ricarica crediti
            </a>
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
              <i class="bi bi-trash3 me-2"></i>Elimina utente
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-12 col-md-6">
      <div class="card h-100 text-center shadow-sm game-card" id="card-personaggi">
        <div class="card-header bg-primary text-white">
          <i class="bi bi-people fs-4"></i>
        </div>
        <div class="card-body">
          <h5 class="card-title">Personaggi</h5>
          <p class="card-text text-muted small">Crea e gestisci i tuoi personaggi</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('characters.create_char') }}" class="btn btn-success">
              <i class="bi bi-person-plus me-2"></i>Crea personaggio
            </a>
            <a href="{{ url_for('characters.mostra_personaggi') }}" class="btn btn-primary">
              <i class="bi bi-people-fill me-2"></i>Lista personaggi
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sezione: Modalità di Gioco -->
<div class="container mt-4 section-block" id="modalita-gioco" style="display: none;">
  <h2 class="text-center mb-4 text-success section-title">
    <i class="bi bi-joystick me-2"></i>Modalità di Gioco
  </h2>
  <div class="row g-3">
    <div class="col-12 col-md-6">
      <div class="card h-100 text-center shadow-sm game-card" id="card-gioco">
        <div class="card-header bg-success text-white">
          <i class="bi bi-map fs-4"></i>
        </div>
        <div class="card-body">
          <h5 class="card-title">Missioni & Ambienti</h5>
          <p class="card-text text-muted small">Esplora mondi e affronta missioni</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('mission.select_mission') }}" class="btn btn-info text-white">
              <i class="bi bi-flag me-2"></i>Seleziona missione
            </a>
            <a href="{{ url_for('environment.select_environment') }}" class="btn btn-info">
              <i class="bi bi-globe me-2"></i>Seleziona ambiente
            </a>
            <a href="{{ url_for('environment.show_environment') }}" class="btn btn-outline-info">
              <i class="bi bi-eye me-2"></i>Mostra ambiente
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-12 col-md-6">
      <div class="card h-100 text-center shadow-sm game-card" id="card-inventario">
        <div class="card-header bg-success text-white">
          <i class="bi bi-bag fs-4"></i>
        </div>
        <div class="card-body">
          <h5 class="card-title">Inventario & Battaglia</h5>
          <p class="card-text text-muted small">Gestisci oggetti e combatti</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('inventory.mostra_inventario') }}" class="btn btn-success">
              <i class="bi bi-backpack me-2"></i>Gestisci inventario
            </a>
            <a href="{{ url_for('battle.begin_battle') }}" class="btn btn-secondary">
              <i class="bi bi-sword me-2"></i>Inizia battaglia
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal di conferma eliminazione migliorato -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center border-0 shadow-lg">
      <div class="modal-header border-0 d-block position-relative bg-danger text-white">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle me-2"></i>Conferma eliminazione
        </h5>
        <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Chiudi"></button>
      </div>
      <div class="modal-body py-4">
        <i class="bi bi-person-x fs-1 text-danger mb-3"></i>
        <p class="mb-2">Sei sicuro di voler eliminare il tuo account?</p>
        <p class="text-muted small">Questa operazione non può essere annullata.</p>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">
          <i class="bi bi-x-circle me-2"></i>Annulla
        </button>
        <a href="{{ url_for('auth.delete_user', id=current_user.id) }}" class="btn btn-danger">
          <i class="bi bi-trash3 me-2"></i>Elimina definitivamente
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  /* Gradiente per l'hero */
  .bg-gradient {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    position: relative;
    overflow: hidden;
  }

  .hero-section {
    position: relative;
  }

  /* Animazioni di entrata */
  .fade-in {
    animation: fadeInUp 0.8s ease-out;
  }

  .fade-in-delay {
    animation: fadeInUp 0.8s ease-out 0.2s both;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Pulsanti principali con effetti */
  .main-button {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 2px solid;
  }

  .main-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }

  .button-shine {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }

  .main-button:hover .button-shine {
    left: 100%;
  }

  /* Titoli delle sezioni */
  .section-title {
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    animation: slideInFromTop 0.6s ease-out;
  }

  @keyframes slideInFromTop {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Cards migliorati */
  .game-card {
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
    overflow: hidden;
    border-radius: 1.25rem !important; /* Stesso arrotondamento di rounded-5 */
  }

  .game-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  .game-card .card-header {
    border-bottom: none;
    padding: 1rem;
  }

  /* Evidenziazione sezioni attive */
  .highlight-primary {
    border: 3px solid #0d6efd !important;
    box-shadow: 0 0 0.5rem #0d6efd66;
    animation: pulseBlue 2s infinite;
  }

  .highlight-success {
    border: 3px solid #198754 !important;
    box-shadow: 0 0 0.5rem #19875466;
    animation: pulseGreen 2s infinite;
  }

  @keyframes pulseBlue {
    0% { box-shadow: 0 0 0.5rem #0d6efd66; }
    50% { box-shadow: 0 0 1rem #0d6efd99; }
    100% { box-shadow: 0 0 0.5rem #0d6efd66; }
  }

  @keyframes pulseGreen {
    0% { box-shadow: 0 0 0.5rem #19875466; }
    50% { box-shadow: 0 0 1rem #19875499; }
    100% { box-shadow: 0 0 0.5rem #19875466; }
  }

  /* Animazioni per le sezioni */
  .section-block {
    animation: slideIn 0.5s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Responsive improvements */
  @media (max-width: 768px) {
    .hero-section {
      padding: 2rem 0;
    }
    
    .display-5 {
      font-size: 2rem;
    }
    
    .game-card {
      margin-bottom: 1rem;
    }
  }
</style>

{% endblock %}

{% block scripts %}
<script>
  function showSection(sectionId) {
    const sections = ['area-personale', 'modalita-gioco'];
    const buttons = {
      'area-personale': document.getElementById('btn-area'),
      'modalita-gioco': document.getElementById('btn-gioco')
    };

    const cardsBySection = {
      'area-personale': [
        document.getElementById('card-profilo'),
        document.getElementById('card-personaggi')
      ],
      'modalita-gioco': [
        document.getElementById('card-gioco'),
        document.getElementById('card-inventario')
      ]
    };

    // Nascondi tutte le sezioni e resetta i pulsanti
    sections.forEach(id => {
      const section = document.getElementById(id);
      if (section) {
        section.style.display = 'none';
        section.classList.remove('section-block');
      }

      buttons[id].classList.remove('btn-primary', 'btn-success', 'text-white');
      buttons[id].classList.add(
        id === 'area-personale' ? 'btn-outline-primary' : 'btn-outline-success'
      );

      // Rimuovi evidenziazione dalle cards
      cardsBySection[id].forEach(card => {
        if (card) {
          card.classList.remove('highlight-primary', 'highlight-success');
        }
      });
    });

    // Mostra la sezione selezionata con animazione
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
      targetSection.style.display = 'block';
      targetSection.classList.add('section-block');
    }

    // Aggiorna stile del pulsante attivo
    if (sectionId === 'area-personale') {
      buttons[sectionId].classList.remove('btn-outline-primary');
      buttons[sectionId].classList.add('btn-primary', 'text-white');

      // Evidenzia le cards
      cardsBySection[sectionId].forEach(card => {
        if (card) card.classList.add('highlight-primary');
      });
    } else {
      buttons[sectionId].classList.remove('btn-outline-success');
      buttons[sectionId].classList.add('btn-success', 'text-white');

      // Evidenzia le cards
      cardsBySection[sectionId].forEach(card => {
        if (card) card.classList.add('highlight-success');
      });
    }

    // Scroll fluido alla sezione
    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // Inizializza la pagina
  document.addEventListener('DOMContentLoaded', () => {
    // Piccolo delay per permettere il caricamento completo
    setTimeout(() => {
      showSection('area-personale');
    }, 100);
  });

  // Aggiungi effetto di hover sulle cards
  document.querySelectorAll('.game-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-5px)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
    });
  });
</script>
{% endblock %}